!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkdriver=self.webpackChunkdriver||[]).push([[3952],{3952:function(n,i,o){"use strict";o.r(i),o.d(i,{HomePageModule:function(){return S}});var r=o(8583),a=o(3679),c=o(2859),s=o(3025),l=o(9019),d=o(5257),u=o(7716),g=o(4050),p=o(6999),v=o(7556),h=o(7234),m=o(7152),f=o(5469),b=o(5620),C=o(9315),O=o(9829),M=o(7446);function P(e,n){1&e&&(u.TgZ(0,"p",10),u._uU(1,"Sua conta ainda n\xe3o foi aprovada"),u.qZA())}var _,k,y=[{path:"",component:(_=function(){function n(t,i,o,r,a,c,s,d,u,g,p,v,h,m,f){e(this,n),this.driverService=t,this.alertCtrl=i,this.dealService=o,this.authService=r,this.placeService=a,this.geolocation=c,this.translate=s,this.router=d,this.menuCtrl=u,this.platform=g,this.common=p,this.permission=v,this.afAuth=h,this.loadCtrl=m,this.tripService=f,this.driver={},this.isDriverAvailable=!1,this.dealStatus=!1,this.position=[],this.remainingTime=l.B5}return t(n,[{key:"loadMap",value:function(e,n){var t=new google.maps.LatLng(e,n),i=l.NZ.mapOptions;i.center=t,i.mapTypeId=google.maps.MapTypeId.ROADMAP,this.map=new google.maps.Map(document.getElementById("map"),i),this.marker=new google.maps.Marker({map:this.map,animation:google.maps.Animation.DROP,position:t,icon:{url:"./assets/img/marker.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),scaledSize:new google.maps.Size(32,32)}})}},{key:"changeAvailability",value:function(){var e=this;clearInterval(this.positionTracking),this.platform.is("mobile")&&1==this.driver.isOnline&&this.permission.checkPermission(this.permission.PERMISSION.ACCESS_FINE_LOCATION).then(function(n){e.common.showToast("Aplica\xe7ao deseja permissao: "+n.hasPermission),n.hasPermission||e.permission.requestPermission(e.permission.PERMISSION.ACCESS_FINE_LOCATION).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)}),!0===this.driver.isOnline?(this.loadCtrl.create({spinner:"circles",id:"location-access",duration:1e4}).then(function(n){e.loader=n,e.loader.present()}),this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(function(n){null!==e.loader&&e.loader.dismiss(),e.driverService.getDriver(e.driver.uid).update({isOnline:!0}),e.position=[n.coords.latitude,n.coords.longitude];var t=new google.maps.LatLng(n.coords.latitude,n.coords.longitude),i=new google.maps.Geocoder;e.loadMap(n.coords.latitude,n.coords.longitude),i.geocode({latLng:t},function(n,t){t==google.maps.GeocoderStatus.OK&&(e.locality=e.placeService.setLocalityFromGeocoder(n),e.positionTracking=setInterval(function(){e.driver&&e.driver.type&&e.driver.isOnline&&e.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(function(n){e.driverService.updatePosition(e.driver.uid,e.driver.type,e.locality,n.coords.latitude,n.coords.longitude,e.driver.rating,e.driver.name);var t=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);e.marker.setPosition(t),e.map.setCenter(t)},function(n){e.common.showToast(n.message),console.log(n)})},l.YL),e.watchDeals())})},function(n){console.log(n),e.loadCtrl.dismiss(),e.common.showToast("Houve um problema para determinar a sua localiza\xe7ao"),e.driver.isOnline=!1,e.driverService.getDriver(e.driver.uid).update({isOnline:!1})})):(clearInterval(this.positionTracking),this.driverService.getDriver(this.driver.uid).update({isOnline:!1}),this.driverService.remove(this.driver.uid,this.driver.type,this.locality),this.dealSubscription&&this.dealSubscription.unsubscribe(),this.common.showToast("Voc\xea est\xe1 Offline agora"))}},{key:"countDown",value:function(){var e=this,n=setInterval(function(){e.remainingTime--,e.dealAlert.subHeader="Voc\xea tem "+e.remainingTime+" sec, para confirmar o atendimento",0===e.remainingTime&&(clearInterval(n),e.cancelDeal(),e.remainingTime=l.B5)},1e3);this.confirmJob()}},{key:"cancelDeal",value:function(){this.dealStatus=!1,this.dealAlert.dismiss(),this.dealService.removeDeal(this.driver.uid)}},{key:"ionViewDidEnter",value:function(){var e=this;this.menuCtrl.enable(!0),this.afAuth.onAuthStateChanged(function(n){null!=n&&(e.driverService.getDriver(n.uid).valueChanges().subscribe(function(n){null!=n&&(e.driver=n,e.driver.isOnline&&e.platform.is("mobile")&&(e.platform.pause.pipe((0,d.q)(1)).subscribe(function(){e.driver.isOnline&&(cordova.plugins.backgroundMode.setDefaults({id:-1,title:"Aplicativo do T\xe9cnico",text:"Background",hidden:!1,silent:!1}),cordova.plugins.backgroundMode.setEnabled(!0),cordova.plugins.backgroundMode.on("enable",function(){console.log("background mode Enabled !!!"),cordova.plugins.backgroundMode.disableWebViewOptimizations(),cordova.plugins.backgroundMode.disableBatteryOptimizations()}))}),cordova.plugins.backgroundMode.on("active",function(){return console.log("bgm: active")}),cordova.plugins.backgroundMode.on("deactivate",function(){return console.log("bgm: deactive")}),cordova.plugins.backgroundMode.on("failure",function(){return console.log("bgm: failed")}),cordova.plugins.backgroundMode.on("disable",function(){console.log("bgm: desabilitado")}),e.platform.resume.pipe((0,d.q)(1)).subscribe(function(){return cordova.plugins.backgroundMode.setEnabled(!1)})))}),e.tripService.getLastTrips(n.uid).valueChanges().pipe((0,d.q)(1)).subscribe(function(n){n.forEach(function(n){n.status!=l.MQ&&n.status!=l.MA||(e.tripService.setCurrentTrip(n.key),e.router.navigateByUrl("/pickup"))})}))})}},{key:"range",value:function(e){return new Array(Math.round(e))}},{key:"confirmJob",value:function(){var e=this;this.alertCtrl.create({id:this.job.key,header:"Nova Solicita\xe7\xe3o",message:"<b>Local:</b> ("+this.job.origin.distance+"km)<br/>"+this.job.origin.vicinity,cssClass:"alert-button",buttons:[{text:"Rejeitar",role:"cancel",cssClass:"alert-button",handler:function(){e.dealStatus=!1,e.dealService.removeDeal(e.driver.uid)}},{text:"Aceitar",handler:function(){e.dealStatus=!1,e.dealService.acceptDeal(e.driver.uid,e.deal).then(function(){e.router.navigateByUrl("pickup")})}}]}).then(function(n){e.dealAlert=n,e.dealAlert.present()}),this.playAudio()}},{key:"watchDeals",value:function(){var e=this;this.dealSubscription=this.dealService.getDeal(this.driver.uid).valueChanges().subscribe(function(n){if(n&&(e.deal=n,n.status==l.MN)){if(n.createdAt<Date.now()-1e3*l.B5)return e.dealService.removeDeal(e.driver.uid);e.dealStatus=!0,e.job=n,e.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(function(n){e.job.origin.distance=e.placeService.calcCrow(n.coords.latitude,n.coords.longitude,e.job.origin.location.lat,e.job.origin.location.lng).toFixed(0),e.countDown()},function(n){return e.common.showToast(n.message)})}})}},{key:"playAudio",value:function(){1==l.SS&&new Audio(l.VR).play()}}]),n}(),_.\u0275fac=function(e){return new(e||_)(u.Y36(g.F),u.Y36(c.Br),u.Y36(p.q),u.Y36(v.e),u.Y36(h.k),u.Y36(m.b),u.Y36(f.sK),u.Y36(s.F0),u.Y36(c._q),u.Y36(c.t4),u.Y36(b.v),u.Y36(C.r),u.Y36(O.zQ),u.Y36(c.HT),u.Y36(M.a))},_.\u0275cmp=u.Xpm({type:_,selectors:[["app-home"]],decls:21,vars:11,consts:[["color","dark"],["slot","start"],["lines","none"],["onerror","this.src='./assets/img/default.png'",3,"src"],[2,"font-weight","500"],["name","star"],["slot","end",3,"ngModel","disabled","ionChange","ngModelChange"],[2,"margin","0","font-size","12px","font-size","12px","padding","4px 8px"],["class","message",4,"ngIf"],["id","map",2,"height","100%","width","100%"],[1,"message"]],template:function(e,n){1&e&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar",0),u.TgZ(2,"ion-buttons",1),u._UZ(3,"ion-menu-button"),u.qZA(),u.TgZ(4,"ion-title"),u._uU(5," JetPort "),u.qZA(),u.qZA(),u.TgZ(6,"ion-item",2),u.TgZ(7,"ion-avatar",1),u._UZ(8,"img",3),u.qZA(),u.TgZ(9,"ion-label"),u.TgZ(10,"h3",4),u._uU(11),u._UZ(12,"ion-icon",5),u.qZA(),u.TgZ(13,"p"),u._uU(14),u.qZA(),u.qZA(),u.TgZ(15,"ion-toggle",6),u.NdJ("ionChange",function(){return n.changeAvailability()})("ngModelChange",function(e){return n.driver.isOnline=e}),u.qZA(),u.qZA(),u.TgZ(16,"p",7),u._uU(17),u.qZA(),u.qZA(),u.TgZ(18,"ion-content"),u.YNc(19,P,2,0,"p",8),u._UZ(20,"div",9),u.qZA()),2&e&&(u.xp6(8),u.s9C("src",null==n.driver?null:n.driver.photoURL,u.LSH),u.xp6(3),u.AsE("",null==n.driver?null:n.driver.name," - ",null==n.driver?null:n.driver.rating," "),u.xp6(3),u.HOy("",null==n.driver?null:n.driver.brand," \u2022 ",null==n.driver?null:n.driver.model," \u2022\xa0",null==n.driver?null:n.driver.plate," \u2022\xa0",null==n.driver?null:n.driver.type,""),u.xp6(1),u.Q6J("ngModel",n.driver.isOnline)("disabled",!n.driver.isApproved),u.xp6(2),u.hij("Localiza\xe7\xe3o: ",n.locality,""),u.xp6(2),u.Q6J("ngIf",!n.driver.isApproved))},directives:[c.Gu,c.sr,c.Sm,c.fG,c.wd,c.Ie,c.BJ,c.Q$,c.gu,c.ho,c.w,a.JJ,a.On,c.W2,r.O5],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}.message[_ngcontent-%COMP%]{text-align:center;background:#ffc107;margin:0;padding:4px;font-size:14px}.buttoncss[_ngcontent-%COMP%]{color:#e74c3c;background-color:#000}.alertcss[_ngcontent-%COMP%]{background-color:aqua;color:#ffc107}.basic-alert[_ngcontent-%COMP%]{--backdrop-opacity:0.6;--background:linear-gradient(90deg,#1e00c9 1%,#f8fff8)}.alert-button-inner.sc-ion-alert-md[_ngcontent-%COMP%]{justify-content:flex-end;display:flex;flex-flow:row nowrap;flex-shrink:0;align-items:center;justify-content:center;width:100%;height:100%}.ion-tappable[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   span[_ngcontent-%COMP%], a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], button[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{touch-action:manipulation}*[_ngcontent-%COMP%]{box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}.alert-button[_ngcontent-%COMP%]{border-radius:2px;margin:0 8px 0 0;padding:10px;position:relative;background-color:#d4333300;color:#8a1616;font-weight:500;text-align:end;text-transform:uppercase;overflow:hidden}"]}),_)}],w=function(){var n=t(function n(){e(this,n)});return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=u.oAB({type:n}),n.\u0275inj=u.cJS({imports:[[s.Bz.forChild(y)],s.Bz]}),n}(),S=((k=t(function n(){e(this,n)})).\u0275fac=function(e){return new(e||k)},k.\u0275mod=u.oAB({type:k}),k.\u0275inj=u.cJS({imports:[[r.ez,a.u5,c.Pc,f.aw,w]]}),k)}}])}();