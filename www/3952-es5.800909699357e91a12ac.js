!function(){function e(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function i(e,i){for(var o=0;o<i.length;o++){var n=i[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,o,n){return o&&i(e.prototype,o),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkdriver=self.webpackChunkdriver||[]).push([[3952],{3952:function(i,n,t){"use strict";t.r(n),t.d(n,{HomePageModule:function(){return O}});var r=t(8583),a=t(3679),s=t(2859),l=t(3025),c=t(9019),u=t(5257),d=t(7716),g=t(4050),p=t(6999),v=t(7556),h=t(7234),m=t(7152),f=t(5469),b=t(5620),S=t(9315),y=t(9829),A=t(7446);function k(e,i){1&e&&(d.TgZ(0,"p",14),d._uU(1,"Sua conta ainda n\xe3o foi aprovada"),d.qZA())}var w,C,T=[{path:"",component:(w=function(){function i(o,n,t,r,a,s,l,u,d,g,p,v,h,m,f){e(this,i),this.driverService=o,this.alertCtrl=n,this.dealService=t,this.authService=r,this.placeService=a,this.geolocation=s,this.translate=l,this.router=u,this.menuCtrl=d,this.platform=g,this.common=p,this.permission=v,this.afAuth=h,this.loadCtrl=m,this.tripService=f,this.driver={},this.isDriverAvailable=!1,this.dealStatus=!1,this.position=[],this.remainingTime=c.B5}return o(i,[{key:"loadMap",value:function(e,i){var o=new google.maps.LatLng(e,i),n=c.NZ.mapOptions;n.center=o,n.mapTypeId=google.maps.MapTypeId.ROADMAP,this.map=new google.maps.Map(document.getElementById("map"),n),this.marker=new google.maps.Marker({map:this.map,animation:google.maps.Animation.DROP,position:o,icon:{url:"./assets/img/marker.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),scaledSize:new google.maps.Size(32,32)}})}},{key:"changeAvailability",value:function(){var e=this;clearInterval(this.positionTracking),this.platform.is("mobile")&&1==this.driver.isOnline&&(console.log("entrei aqui incialmente"),this.permission.checkPermission(this.permission.PERMISSION.ACCESS_FINE_LOCATION).then(function(i){e.common.showToast("App Location Permission: "+i.hasPermission),i.hasPermission||e.permission.requestPermission(e.permission.PERMISSION.ACCESS_FINE_LOCATION).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})),1==this.driver.isOnline?this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(function(i){e.driverService.getDriver(e.driver.uid).update({isOnline:!0}),e.position=[i.coords.latitude,i.coords.longitude],console.log("position",e.position);var o=new google.maps.LatLng(i.coords.latitude,i.coords.longitude),n=new google.maps.Geocoder;e.loadMap(i.coords.latitude,i.coords.longitude),n.geocode({latLng:o},function(i,o){o==google.maps.GeocoderStatus.OK&&(e.locality=e.placeService.setLocalityFromGeocoder(i),e.positionTracking=setInterval(function(){e.driver&&e.driver.type&&e.driver.isOnline&&e.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(function(i){console.log(i),e.driverService.updatePosition(e.driver.uid,e.driver.type,e.locality,i.coords.latitude,i.coords.longitude,e.driver.rating,e.driver.name);var o=new google.maps.LatLng(i.coords.latitude,i.coords.longitude);e.marker.setPosition(o),e.map.setCenter(o)},function(i){e.common.showToast(i.message),console.log(i)})},c.YL),e.watchDeals())})},function(i){console.log(i),e.loadCtrl.dismiss(),e.common.showToast("Something went wrong while accessing your location. Please make sure, you have GPS access on device"),e.driver.isOnline=!1,e.driverService.getDriver(e.driver.uid).update({isOnline:!1})}):(clearInterval(this.positionTracking),this.driverService.getDriver(this.driver.uid).update({isOnline:!1}),this.driverService.remove(this.driver.uid,this.driver.type,this.locality),this.dealSubscription&&this.dealSubscription.unsubscribe(),this.common.showToast("Voc\xea est\xe1 Offline agora"))}},{key:"countDown",value:function(){var e=this,i=setInterval(function(){e.remainingTime--,e.dealAlert.subHeader="Fechamento em "+e.remainingTime+" sec",0==e.remainingTime&&(clearInterval(i),e.cancelDeal(),e.remainingTime=c.B5)},1e3);this.confirmJob()}},{key:"cancelDeal",value:function(){console.log("close"),this.dealStatus=!1,this.dealAlert.dismiss(),this.dealService.removeDeal(this.driver.uid)}},{key:"ionViewDidEnter",value:function(){var e=this;this.menuCtrl.enable(!0),this.afAuth.onAuthStateChanged(function(i){console.log("user",i),null!=i&&(e.driverService.getDriver(i.uid).valueChanges().subscribe(function(i){null!=i&&(e.driver=i,e.driver.isOnline&&e.platform.is("mobile")&&(e.platform.pause.pipe((0,u.q)(1)).subscribe(function(){e.driver.isOnline&&(console.log("App minimized"),cordova.plugins.backgroundMode.setDefaults({id:-1,title:"Aplicativo do T\xe9cnico",text:"Background",hidden:!1,silent:!1}),cordova.plugins.backgroundMode.setEnabled(!0),cordova.plugins.backgroundMode.on("enable",function(){console.log("background mode Enabled !!!"),cordova.plugins.backgroundMode.disableWebViewOptimizations(),cordova.plugins.backgroundMode.disableBatteryOptimizations()}))}),cordova.plugins.backgroundMode.on("active",function(){return console.log("bgm: active")}),cordova.plugins.backgroundMode.on("deactivate",function(){return console.log("bgm: deactive")}),cordova.plugins.backgroundMode.on("failure",function(){return console.log("bgm: failed")}),cordova.plugins.backgroundMode.on("disable",function(){console.log("bgm: disable")}),e.platform.resume.pipe((0,u.q)(1)).subscribe(function(){return cordova.plugins.backgroundMode.setEnabled(!1)})))}),e.tripService.getLastTrips(i.uid).valueChanges().pipe((0,u.q)(1)).subscribe(function(i){i.forEach(function(i){i.status!=c.MQ&&i.status!=c.MA||(e.tripService.setCurrentTrip(i.key),e.router.navigateByUrl("/pickup"))})}))})}},{key:"logout",value:function(){var e=this;this.authService.logout().then(function(){localStorage.clear(),e.router.navigateByUrl("/login",{skipLocationChange:!0,replaceUrl:!0})})}},{key:"range",value:function(e){return new Array(Math.round(e))}},{key:"confirmJob",value:function(){var e=this;this.alertCtrl.create({id:this.job.key,header:"Nova Solicita\xe7\xe3o",message:"<b>Local:</b> ("+this.job.origin.distance+"km)<br/>"+this.job.origin.vicinity,cssClass:"customAlert",buttons:[{text:"Rejeitar",role:"cancel",handler:function(){e.dealStatus=!1,e.dealService.removeDeal(e.driver.uid)}},{text:"Aceitar",handler:function(){e.dealStatus=!1,e.dealService.acceptDeal(e.driver.uid,e.deal).then(function(){e.router.navigateByUrl("pickup")})}}]}).then(function(i){e.dealAlert=i,e.dealAlert.present()}),this.playAudio()}},{key:"watchDeals",value:function(){var e=this;this.dealSubscription=this.dealService.getDeal(this.driver.uid).valueChanges().subscribe(function(i){if((null!=i||null!=i)&&(e.deal=i,i.status==c.MN)){if(i.createdAt<Date.now()-1e3*c.B5)return e.dealService.removeDeal(e.driver.uid);e.dealStatus=!0,e.job=i,e.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(function(i){e.job.origin.distance=e.placeService.calcCrow(i.coords.latitude,i.coords.longitude,e.job.origin.location.lat,e.job.origin.location.lng).toFixed(0),e.job.destination.distance=e.placeService.calcCrow(i.coords.latitude,i.coords.longitude,e.job.destination.location.lat,e.job.destination.location.lng).toFixed(0),e.countDown()},function(i){return e.common.showToast(i.message)})}})}},{key:"playAudio",value:function(){1==c.SS&&new Audio(c.VR).play()}}]),i}(),w.\u0275fac=function(e){return new(e||w)(d.Y36(g.F),d.Y36(s.Br),d.Y36(p.q),d.Y36(v.e),d.Y36(h.k),d.Y36(m.b),d.Y36(f.sK),d.Y36(l.F0),d.Y36(s._q),d.Y36(s.t4),d.Y36(b.v),d.Y36(S.r),d.Y36(y.zQ),d.Y36(s.HT),d.Y36(A.a))},w.\u0275cmp=d.Xpm({type:w,selectors:[["app-home"]],decls:24,vars:11,consts:[["color","dark"],["slot","start"],[1,"ion-text-center"],["slot","end"],[3,"click"],["name","log-out"],["lines","none"],["onerror","this.src='./assets/img/default.png'",3,"src"],[2,"font-weight","500"],["name","star"],["slot","end",3,"ngModel","disabled","ionChange","ngModelChange"],[2,"margin","0","font-size","12px","font-size","12px","padding","4px 8px"],["class","message",4,"ngIf"],["id","map",2,"height","100%","width","100%"],[1,"message"]],template:function(e,i){1&e&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar",0),d.TgZ(2,"ion-buttons",1),d._UZ(3,"ion-menu-button"),d.qZA(),d.TgZ(4,"ion-title",2),d._uU(5," JetPort "),d.qZA(),d.TgZ(6,"ion-buttons",3),d.TgZ(7,"ion-button",4),d.NdJ("click",function(){return i.logout()}),d._UZ(8,"ion-icon",5),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-item",6),d.TgZ(10,"ion-avatar",1),d._UZ(11,"img",7),d.qZA(),d.TgZ(12,"ion-label"),d.TgZ(13,"h3",8),d._uU(14),d._UZ(15,"ion-icon",9),d.qZA(),d.TgZ(16,"p"),d._uU(17),d.qZA(),d.qZA(),d.TgZ(18,"ion-toggle",10),d.NdJ("ionChange",function(){return i.changeAvailability()})("ngModelChange",function(e){return i.driver.isOnline=e}),d.qZA(),d.qZA(),d.TgZ(19,"p",11),d._uU(20),d.qZA(),d.qZA(),d.TgZ(21,"ion-content"),d.YNc(22,k,2,0,"p",12),d._UZ(23,"div",13),d.qZA()),2&e&&(d.xp6(11),d.s9C("src",null==i.driver?null:i.driver.photoURL,d.LSH),d.xp6(3),d.AsE("",null==i.driver?null:i.driver.name," - ",null==i.driver?null:i.driver.rating," "),d.xp6(3),d.HOy("",null==i.driver?null:i.driver.brand," \u2022 ",null==i.driver?null:i.driver.model," \u2022\xa0",null==i.driver?null:i.driver.plate," \u2022\xa0",null==i.driver?null:i.driver.type,""),d.xp6(1),d.Q6J("ngModel",i.driver.isOnline)("disabled",!i.driver.isApproved),d.xp6(2),d.hij("Localiza\xe7\xe3o: ",i.locality,""),d.xp6(2),d.Q6J("ngIf",!i.driver.isApproved))},directives:[s.Gu,s.sr,s.Sm,s.fG,s.wd,s.YG,s.gu,s.Ie,s.BJ,s.Q$,s.ho,s.w,a.JJ,a.On,s.W2,r.O5],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}.message[_ngcontent-%COMP%]{text-align:center;background:#ffc107;margin:0;padding:4px;font-size:14px}"]}),w)}],Z=function(){var i=o(function i(){e(this,i)});return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=d.oAB({type:i}),i.\u0275inj=d.cJS({imports:[[l.Bz.forChild(T)],l.Bz]}),i}(),O=((C=o(function i(){e(this,i)})).\u0275fac=function(e){return new(e||C)},C.\u0275mod=d.oAB({type:C}),C.\u0275inj=d.cJS({imports:[[r.ez,a.u5,s.Pc,f.aw,Z]]}),C)}}])}();