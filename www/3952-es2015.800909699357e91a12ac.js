(self.webpackChunkdriver=self.webpackChunkdriver||[]).push([[3952],{3952:function(e,i,t){"use strict";t.r(i),t.d(i,{HomePageModule:function(){return C}});var o=t(8583),s=t(3679),n=t(2859),r=t(3025),a=t(9019),l=t(5257),c=t(7716),d=t(4050),h=t(6999),g=t(7556),u=t(7234),p=t(7152),m=t(5469),v=t(5620),b=t(9315),S=t(9829),A=t(7446);function f(e,i){1&e&&(c.TgZ(0,"p",14),c._uU(1,"Sua conta ainda n\xe3o foi aprovada"),c.qZA())}const w=[{path:"",component:(()=>{class e{constructor(e,i,t,o,s,n,r,l,c,d,h,g,u,p,m){this.driverService=e,this.alertCtrl=i,this.dealService=t,this.authService=o,this.placeService=s,this.geolocation=n,this.translate=r,this.router=l,this.menuCtrl=c,this.platform=d,this.common=h,this.permission=g,this.afAuth=u,this.loadCtrl=p,this.tripService=m,this.driver={},this.isDriverAvailable=!1,this.dealStatus=!1,this.position=[],this.remainingTime=a.B5}loadMap(e,i){let t=new google.maps.LatLng(e,i),o=a.NZ.mapOptions;o.center=t,o.mapTypeId=google.maps.MapTypeId.ROADMAP,this.map=new google.maps.Map(document.getElementById("map"),o),this.marker=new google.maps.Marker({map:this.map,animation:google.maps.Animation.DROP,position:t,icon:{url:"./assets/img/marker.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),scaledSize:new google.maps.Size(32,32)}})}changeAvailability(){clearInterval(this.positionTracking),this.platform.is("mobile")&&1==this.driver.isOnline&&(console.log("entrei aqui incialmente"),this.permission.checkPermission(this.permission.PERMISSION.ACCESS_FINE_LOCATION).then(e=>{this.common.showToast("App Location Permission: "+e.hasPermission),e.hasPermission||this.permission.requestPermission(this.permission.PERMISSION.ACCESS_FINE_LOCATION).then(e=>{console.log(e)}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})),1==this.driver.isOnline?this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(e=>{this.driverService.getDriver(this.driver.uid).update({isOnline:!0}),this.position=[e.coords.latitude,e.coords.longitude],console.log("position",this.position);let i=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),t=new google.maps.Geocoder;this.loadMap(e.coords.latitude,e.coords.longitude),t.geocode({latLng:i},(e,i)=>{i==google.maps.GeocoderStatus.OK&&(this.locality=this.placeService.setLocalityFromGeocoder(e),this.positionTracking=setInterval(()=>{this.driver&&this.driver.type&&this.driver.isOnline&&this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(e=>{console.log(e),this.driverService.updatePosition(this.driver.uid,this.driver.type,this.locality,e.coords.latitude,e.coords.longitude,this.driver.rating,this.driver.name);let i=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.marker.setPosition(i),this.map.setCenter(i)},e=>{this.common.showToast(e.message),console.log(e)})},a.YL),this.watchDeals())})},e=>{console.log(e),this.loadCtrl.dismiss(),this.common.showToast("Something went wrong while accessing your location. Please make sure, you have GPS access on device"),this.driver.isOnline=!1,this.driverService.getDriver(this.driver.uid).update({isOnline:!1})}):(clearInterval(this.positionTracking),this.driverService.getDriver(this.driver.uid).update({isOnline:!1}),this.driverService.remove(this.driver.uid,this.driver.type,this.locality),this.dealSubscription&&this.dealSubscription.unsubscribe(),this.common.showToast("Voc\xea est\xe1 Offline agora"))}countDown(){let e=setInterval(()=>{this.remainingTime--,this.dealAlert.subHeader="Fechamento em "+this.remainingTime+" sec",0==this.remainingTime&&(clearInterval(e),this.cancelDeal(),this.remainingTime=a.B5)},1e3);this.confirmJob()}cancelDeal(){console.log("close"),this.dealStatus=!1,this.dealAlert.dismiss(),this.dealService.removeDeal(this.driver.uid)}ionViewDidEnter(){this.menuCtrl.enable(!0),this.afAuth.onAuthStateChanged(e=>{console.log("user",e),null!=e&&(this.driverService.getDriver(e.uid).valueChanges().subscribe(e=>{null!=e&&(this.driver=e,this.driver.isOnline&&this.platform.is("mobile")&&(this.platform.pause.pipe((0,l.q)(1)).subscribe(()=>{this.driver.isOnline&&(console.log("App minimized"),cordova.plugins.backgroundMode.setDefaults({id:-1,title:"Aplicativo do T\xe9cnico",text:"Background",hidden:!1,silent:!1}),cordova.plugins.backgroundMode.setEnabled(!0),cordova.plugins.backgroundMode.on("enable",()=>{console.log("background mode Enabled !!!"),cordova.plugins.backgroundMode.disableWebViewOptimizations(),cordova.plugins.backgroundMode.disableBatteryOptimizations()}))}),cordova.plugins.backgroundMode.on("active",()=>console.log("bgm: active")),cordova.plugins.backgroundMode.on("deactivate",()=>console.log("bgm: deactive")),cordova.plugins.backgroundMode.on("failure",()=>console.log("bgm: failed")),cordova.plugins.backgroundMode.on("disable",()=>{console.log("bgm: disable")}),this.platform.resume.pipe((0,l.q)(1)).subscribe(()=>cordova.plugins.backgroundMode.setEnabled(!1))))}),this.tripService.getLastTrips(e.uid).valueChanges().pipe((0,l.q)(1)).subscribe(e=>{e.forEach(e=>{e.status!=a.MQ&&e.status!=a.MA||(this.tripService.setCurrentTrip(e.key),this.router.navigateByUrl("/pickup"))})}))})}logout(){this.authService.logout().then(()=>{localStorage.clear(),this.router.navigateByUrl("/login",{skipLocationChange:!0,replaceUrl:!0})})}range(e){return new Array(Math.round(e))}confirmJob(){this.alertCtrl.create({id:this.job.key,header:"Nova Solicita\xe7\xe3o",message:"<b>Local:</b> ("+this.job.origin.distance+"km)<br/>"+this.job.origin.vicinity,cssClass:"customAlert",buttons:[{text:"Rejeitar",role:"cancel",handler:()=>{this.dealStatus=!1,this.dealService.removeDeal(this.driver.uid)}},{text:"Aceitar",handler:()=>{this.dealStatus=!1,this.dealService.acceptDeal(this.driver.uid,this.deal).then(()=>{this.router.navigateByUrl("pickup")})}}]}).then(e=>{this.dealAlert=e,this.dealAlert.present()}),this.playAudio()}watchDeals(){this.dealSubscription=this.dealService.getDeal(this.driver.uid).valueChanges().subscribe(e=>{if((null!=e||null!=e)&&(this.deal=e,e.status==a.MN)){if(e.createdAt<Date.now()-1e3*a.B5)return this.dealService.removeDeal(this.driver.uid);this.dealStatus=!0,this.job=e,this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(e=>{this.job.origin.distance=this.placeService.calcCrow(e.coords.latitude,e.coords.longitude,this.job.origin.location.lat,this.job.origin.location.lng).toFixed(0),this.job.destination.distance=this.placeService.calcCrow(e.coords.latitude,e.coords.longitude,this.job.destination.location.lat,this.job.destination.location.lng).toFixed(0),this.countDown()},e=>this.common.showToast(e.message))}})}playAudio(){1==a.SS&&new Audio(a.VR).play()}}return e.\u0275fac=function(i){return new(i||e)(c.Y36(d.F),c.Y36(n.Br),c.Y36(h.q),c.Y36(g.e),c.Y36(u.k),c.Y36(p.b),c.Y36(m.sK),c.Y36(r.F0),c.Y36(n._q),c.Y36(n.t4),c.Y36(v.v),c.Y36(b.r),c.Y36(S.zQ),c.Y36(n.HT),c.Y36(A.a))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-home"]],decls:24,vars:11,consts:[["color","dark"],["slot","start"],[1,"ion-text-center"],["slot","end"],[3,"click"],["name","log-out"],["lines","none"],["onerror","this.src='./assets/img/default.png'",3,"src"],[2,"font-weight","500"],["name","star"],["slot","end",3,"ngModel","disabled","ionChange","ngModelChange"],[2,"margin","0","font-size","12px","font-size","12px","padding","4px 8px"],["class","message",4,"ngIf"],["id","map",2,"height","100%","width","100%"],[1,"message"]],template:function(e,i){1&e&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar",0),c.TgZ(2,"ion-buttons",1),c._UZ(3,"ion-menu-button"),c.qZA(),c.TgZ(4,"ion-title",2),c._uU(5," JetPort "),c.qZA(),c.TgZ(6,"ion-buttons",3),c.TgZ(7,"ion-button",4),c.NdJ("click",function(){return i.logout()}),c._UZ(8,"ion-icon",5),c.qZA(),c.qZA(),c.qZA(),c.TgZ(9,"ion-item",6),c.TgZ(10,"ion-avatar",1),c._UZ(11,"img",7),c.qZA(),c.TgZ(12,"ion-label"),c.TgZ(13,"h3",8),c._uU(14),c._UZ(15,"ion-icon",9),c.qZA(),c.TgZ(16,"p"),c._uU(17),c.qZA(),c.qZA(),c.TgZ(18,"ion-toggle",10),c.NdJ("ionChange",function(){return i.changeAvailability()})("ngModelChange",function(e){return i.driver.isOnline=e}),c.qZA(),c.qZA(),c.TgZ(19,"p",11),c._uU(20),c.qZA(),c.qZA(),c.TgZ(21,"ion-content"),c.YNc(22,f,2,0,"p",12),c._UZ(23,"div",13),c.qZA()),2&e&&(c.xp6(11),c.s9C("src",null==i.driver?null:i.driver.photoURL,c.LSH),c.xp6(3),c.AsE("",null==i.driver?null:i.driver.name," - ",null==i.driver?null:i.driver.rating," "),c.xp6(3),c.HOy("",null==i.driver?null:i.driver.brand," \u2022 ",null==i.driver?null:i.driver.model," \u2022\xa0",null==i.driver?null:i.driver.plate," \u2022\xa0",null==i.driver?null:i.driver.type,""),c.xp6(1),c.Q6J("ngModel",i.driver.isOnline)("disabled",!i.driver.isApproved),c.xp6(2),c.hij("Localiza\xe7\xe3o: ",i.locality,""),c.xp6(2),c.Q6J("ngIf",!i.driver.isApproved))},directives:[n.Gu,n.sr,n.Sm,n.fG,n.wd,n.YG,n.gu,n.Ie,n.BJ,n.Q$,n.ho,n.w,s.JJ,s.On,n.W2,o.O5],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}.message[_ngcontent-%COMP%]{text-align:center;background:#ffc107;margin:0;padding:4px;font-size:14px}"]}),e})()}];let k=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[r.Bz.forChild(w)],r.Bz]}),e})(),C=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[o.ez,s.u5,n.Pc,m.aw,k]]}),e})()}}]);