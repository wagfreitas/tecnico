{"version":3,"sources":["webpack:///src/app/pickup/pickup.page.html","webpack:///src/app/pickup/pickup-routing.module.ts","webpack:///src/app/pickup/pickup.module.ts","webpack:///src/app/pickup/pickup.page.scss","webpack:///src/app/pickup/pickup.page.ts"],"names":["routes","path","component","PickupPageRoutingModule","imports","forChild","exports","PickupPageModule","declarations","PickupPage","tripService","alertCtrl","dealService","router","common","translate","db","menuCtrl","geolocation","trip","passenger","isTripStarted","enable","getCurrentTrip","discount","rawfee","toFixed","tax","fee","getTrips","getTripStatus","key","valueChanges","subscribe","console","log","status","unsubscribe","cancel","removeDeal","driverId","showAlert","navigateByUrl","skipLocationChange","replaceUrl","getPassenger","passengerId","pipe","snapshot","create","message","buttons","text","handler","then","res","present","subHeader","inputs","name","placeholder","type","data","object","otp","pickUp","lat","lng","getCurrentPosition","geo","coords","latitude","url","longitude","window","open","err","header","dropOff","selector","template"],"mappings":"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","file":"pickup-pickup-module-es5.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar color=\\\"dark\\\">\\n    <ion-title> Dados do Atendimento </ion-title>\\n    <ion-buttons slot=\\\"end\\\" *ngIf=\\\"trip.status == 'waiting'\\\">\\n      <ion-button color=\\\"danger\\\" fill=\\\"solid\\\" (click)=\\\"cancelTrip()\\\">CANCELA\\n      </ion-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <ion-card>\\n    <ion-card-content>\\n      <ion-list lines=\\\"none\\\">\\n        <ion-item *ngIf=\\\"passenger.phoneNumber\\\">\\n          <ion-label>\\n            <ion-text>\\n              <h2>{{(passenger)?.name }}</h2>\\n            </ion-text>\\n            <ion-text>\\n              <p>{{(passenger)?.phoneNumber }}</p>\\n            </ion-text>\\n          </ion-label>\\n          <ion-button slot=\\\"end\\\" href=\\\"tel:{{passenger.phoneNumber}}\\\">\\n            <ion-icon name=\\\"call\\\"></ion-icon>&nbsp; FONE\\n          </ion-button>\\n\\n        </ion-item>\\n        <ion-item>\\n          <ion-label>\\n            <ion-text>\\n              <h2>LOCAL</h2>\\n            </ion-text>\\n            <ion-text>\\n              <p *ngIf=\\\"trip.origin != undefined\\\">{{ trip.origin.vicinity }}</p>\\n            </ion-text>\\n          </ion-label>\\n          <ion-button slot=\\\"end\\\" fill=\\\"outline\\\" color=\\\"dark\\\"\\n            (click)=\\\"getDirection(trip.origin.location.lat,trip.origin.location.lng)\\\">\\n            <ion-icon name=\\\"navigate\\\"></ion-icon>&nbsp; NAVEGAR\\n          </ion-button>\\n        </ion-item>\\n        <!--ion-item>\\n          <ion-label>\\n            <ion-text>\\n              <h2>{{'TO' | translate}}</h2>\\n            </ion-text>\\n            <ion-text>\\n              <p *ngIf=\\\"trip.destination != undefined\\\">{{ trip.destination.vicinity }}</p>\\n            </ion-text>\\n          </ion-label>\\n          <ion-button slot=\\\"end\\\" fill=\\\"outline\\\" color=\\\"dark\\\"\\n            (click)=\\\"getDirection(trip.destination.location.lat,trip.destination.location.lng)\\\">\\n            <ion-icon name=\\\"navigate\\\"></ion-icon>&nbsp; {{'NAVIGATE' | translate}}\\n          </ion-button>\\n        </ion-item-->\\n      </ion-list>\\n    </ion-card-content>\\n  </ion-card>\\n  <div class=\\\"ion-padding\\\">\\n    <table>\\n      <tr>\\n        <td>TOTAL: </td>\\n        <td>{{ trip.currency }} {{trip.fee}} <span class=\\\"payment-mode\\\">{{trip.paymentMethod}}</span></td>\\n      </tr>\\n    </table>\\n  </div>\\n</ion-content>\\n<ion-footer class=\\\"ion-padding\\\">\\n  <ion-toolbar>\\n    <ion-button *ngIf=\\\"trip.status == 'waiting'\\\" expand=\\\"block\\\" color=\\\"dark\\\" (click)=\\\"pickup()\\\">INICIAR ATENDIMENTO\\n    </ion-button>\\n    <ion-button *ngIf=\\\"trip.status == 'going'\\\" expand=\\\"block\\\" color=\\\"danger\\\" (click)=\\\"showPayment()\\\">\\n     COMPLETAR ATENDIMENTO</ion-button>\\n  </ion-toolbar>\\n</ion-footer>\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PickupPage } from './pickup.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PickupPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PickupPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PickupPageRoutingModule } from './pickup-routing.module';\n\nimport { PickupPage } from './pickup.page';\nimport { TranslateModule } from '@ngx-translate/core';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    TranslateModule,\n    PickupPageRoutingModule\n  ],\n  declarations: [PickupPage]\n})\nexport class PickupPageModule {}\n","export default \"h3 {\\n  text-align: center;\\n  padding: 8px;\\n  color: #4CAF50;\\n  font-size: 2rem;\\n}\\n\\ntable {\\n  width: 100%;\\n}\\n\\ntr {\\n  border: 1px solid #eee;\\n}\\n\\ntd {\\n  padding: 4px;\\n}\\n\\n.footer-md:before {\\n  background-image: none !important;\\n}\\n\\n.payment-mode {\\n  background: #f2f2f2;\\n  padding: 2px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGlja3VwL3BpY2t1cC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxrQkFBQTtFQUNBLFlBQUE7RUFDQSxjQUFBO0VBQ0EsZUFBQTtBQUNKOztBQUVBO0VBQ0ksV0FBQTtBQUNKOztBQUVBO0VBQ0ksc0JBQUE7QUFDSjs7QUFFQTtFQUNJLFlBQUE7QUFDSjs7QUFFQTtFQUNJLGlDQUFBO0FBQ0o7O0FBRUE7RUFDSSxtQkFBQTtFQUNBLFlBQUE7QUFDSiIsImZpbGUiOiJzcmMvYXBwL3BpY2t1cC9waWNrdXAucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiaDN7XG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIHBhZGRpbmc6IDhweDtcbiAgICBjb2xvcjogIzRDQUY1MDtcbiAgICBmb250LXNpemU6IDJyZW07XG59XG5cbnRhYmxle1xuICAgIHdpZHRoOiAxMDAlO1xufVxuXG50cntcbiAgICBib3JkZXI6IDFweCBzb2xpZCAjZWVlO1xufVxuXG50ZHtcbiAgICBwYWRkaW5nOiA0cHg7XG59XG5cbi5mb290ZXItbWQ6YmVmb3Jle1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IG5vbmUgIWltcG9ydGFudDtcbn1cblxuLnBheW1lbnQtbW9kZXtcbiAgICBiYWNrZ3JvdW5kOiAjZjJmMmYyO1xuICAgIHBhZGRpbmc6MnB4O1xufSJdfQ== */\";","import { Component, OnInit } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { TripService } from '../services/trip.service';\nimport { Router } from '@angular/router';\nimport { DealService } from '../services/deal.service';\nimport { Observable } from 'rxjs';\nimport { take } from 'rxjs/operators'\nimport { AlertController, MenuController } from '@ionic/angular';\nimport { CommonService } from '../services/common.service';\nimport { AngularFireDatabase } from '@angular/fire/database';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\n\n\n@Component({\n  selector: 'app-pickup',\n  templateUrl: './pickup.page.html',\n  styleUrls: ['./pickup.page.scss'],\n})\nexport class PickupPage implements OnInit {\n\n\n  trip: any = {};\n  passenger: any = {};\n  isTripStarted = false;\n  discount;\n  tax;\n\n  constructor(\n    private tripService: TripService,\n    private alertCtrl: AlertController,\n    private dealService: DealService,\n    private router: Router,\n    private common: CommonService,\n    private translate: TranslateService,\n    private db: AngularFireDatabase,\n    private menuCtrl: MenuController,\n    private geolocation: Geolocation\n  ) {\n    this.menuCtrl.enable(true);\n  }\n\n  ngOnInit() { }\n\n  ionViewDidEnter() {\n    this.trip = this.tripService.getCurrentTrip();\n    this.discount = (this.trip.rawfee * (this.trip.discount / 100)).toFixed(2)\n    this.tax = (this.trip.fee * (this.trip.tax / 100)).toFixed(2);\n    let getTrips = this.tripService.getTripStatus(this.trip.key).valueChanges().subscribe((trip: any) => {\n      console.log(trip);\n      this.trip.status = trip.status;\n      if (trip.status == 'canceled') {\n        getTrips.unsubscribe();\n        this.tripService.cancel(this.trip.key);\n        this.dealService.removeDeal(this.trip.driverId);\n        this.common.showAlert(\"Atendimento Cancelado\");\n        this.router.navigateByUrl('/home', { skipLocationChange: true, replaceUrl: true });\n      }\n      else if (trip.status == 'finished') {\n        this.router.navigateByUrl('/home', { skipLocationChange: true, replaceUrl: true });\n      }\n    })\n    this.tripService.getPassenger(this.trip.passengerId).valueChanges().pipe(take(1)).subscribe(snapshot => {\n      this.passenger = snapshot;\n    })\n  }\n\n\n  cancelTrip() {\n    this.alertCtrl.create({\n      message: \"Deseja cancelar o atendimento\",\n      buttons: [{\n        text: \"Sim\",\n        handler: () => this.tripService.cancel(this.trip.key)\n      }, {\n        text: \"Não\"\n      }]\n    }).then(res => res.present());\n  }\n\n  // pickup\n  pickup() {\n    this.alertCtrl.create({\n      subHeader: \"Entre com o Código de Atendimento\",\n      inputs: [{\n        name: 'otp',\n        placeholder: '4 digitos',\n        type: 'tel',\n      }],\n      buttons: [{\n        text: \"Verificar\",\n        handler: (data) => {\n          console.log(data);\n          this.db.object('trips/' + this.trip.key).valueChanges().pipe(take(1)).subscribe((res: any) => {\n            console.log(res);\n            if (res.otp != data.otp) this.common.showAlert(\"Código Inválido\");\n            else {\n              this.isTripStarted = true;\n              this.tripService.pickUp(this.trip.key);\n            }\n          })\n        }\n      }]\n    }).then(res => res.present());\n  }\n\n  getDirection(lat, lng) {\n    console.log(\"call\");\n    this.geolocation.getCurrentPosition().then(geo => {\n      geo.coords.latitude\n      let url = \"https://www.google.com/maps/dir/?api=1&travelmode=driving&origin=\" + geo.coords.latitude + \",\" + geo.coords.longitude + \"&destination=\" + lat + \",\" + lng;\n      window.open(url);\n    }).catch(err => {\n      console.log(\"Error \");\n    })\n  }\n\n\n  showPayment() {\n    this.alertCtrl.create({\n      header: \"Deseja completar o atendimento?\",\n      buttons: [\n        {\n          text: 'Sim',\n          handler: () => {\n            this.tripService.dropOff(this.trip.key);\n            this.dealService.removeDeal(this.trip.driverId);\n            this.router.navigateByUrl('/home');\n          }\n        },\n        {\n          text: \"Não\"\n        }\n      ]\n    }).then(res => res.present());\n  }\n}\n"]}