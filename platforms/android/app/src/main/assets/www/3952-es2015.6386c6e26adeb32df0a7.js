(self.webpackChunkdriver=self.webpackChunkdriver||[]).push([[3952],{3952:function(e,t,i){"use strict";i.r(t),i.d(t,{HomePageModule:function(){return _}});var n=i(8583),o=i(3679),r=i(2859),s=i(3025),a=i(9019),l=i(5257),c=i(7716),d=i(4050),g=i(6999),h=i(7556),u=i(7234),p=i(7152),m=i(5469),v=i(5620),b=i(9315),C=i(9829),M=i(7446);function O(e,t){1&e&&(c.TgZ(0,"p",10),c._uU(1,"Sua conta ainda n\xe3o foi aprovada"),c.qZA())}const f=[{path:"",component:(()=>{class e{constructor(e,t,i,n,o,r,s,l,c,d,g,h,u,p,m){this.driverService=e,this.alertCtrl=t,this.dealService=i,this.authService=n,this.placeService=o,this.geolocation=r,this.translate=s,this.router=l,this.menuCtrl=c,this.platform=d,this.common=g,this.permission=h,this.afAuth=u,this.loadCtrl=p,this.tripService=m,this.driver={},this.isDriverAvailable=!1,this.dealStatus=!1,this.position=[],this.remainingTime=a.B5}loadMap(e,t){let i=new google.maps.LatLng(e,t),n=a.NZ.mapOptions;n.center=i,n.mapTypeId=google.maps.MapTypeId.ROADMAP,this.map=new google.maps.Map(document.getElementById("map"),n),this.marker=new google.maps.Marker({map:this.map,animation:google.maps.Animation.DROP,position:i,icon:{url:"./assets/img/marker.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),scaledSize:new google.maps.Size(32,32)}})}changeAvailability(){clearInterval(this.positionTracking),this.platform.is("mobile")&&1==this.driver.isOnline&&this.permission.checkPermission(this.permission.PERMISSION.ACCESS_FINE_LOCATION).then(e=>{this.common.showToast("Aplica\xe7ao deseja permissao: "+e.hasPermission),e.hasPermission||this.permission.requestPermission(this.permission.PERMISSION.ACCESS_FINE_LOCATION).then(e=>{console.log(e)}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)}),!0===this.driver.isOnline?(this.loadCtrl.create({spinner:"circles",id:"location-access",duration:1e4}).then(e=>{this.loader=e,this.loader.present()}),this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(e=>{null!==this.loader&&this.loader.dismiss(),this.driverService.getDriver(this.driver.uid).update({isOnline:!0}),this.position=[e.coords.latitude,e.coords.longitude];let t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),i=new google.maps.Geocoder;this.loadMap(e.coords.latitude,e.coords.longitude),i.geocode({latLng:t},(e,t)=>{t==google.maps.GeocoderStatus.OK&&(this.locality=this.placeService.setLocalityFromGeocoder(e),this.positionTracking=setInterval(()=>{this.driver&&this.driver.type&&this.driver.isOnline&&this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(e=>{this.driverService.updatePosition(this.driver.uid,this.driver.type,this.locality,e.coords.latitude,e.coords.longitude,this.driver.rating,this.driver.name);let t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.marker.setPosition(t),this.map.setCenter(t)},e=>{this.common.showToast(e.message),console.log(e)})},a.YL),this.watchDeals())})},e=>{console.log(e),this.loadCtrl.dismiss(),this.common.showToast("Houve um problema para determinar a sua localiza\xe7ao"),this.driver.isOnline=!1,this.driverService.getDriver(this.driver.uid).update({isOnline:!1})})):(clearInterval(this.positionTracking),this.driverService.getDriver(this.driver.uid).update({isOnline:!1}),this.driverService.remove(this.driver.uid,this.driver.type,this.locality),this.dealSubscription&&this.dealSubscription.unsubscribe(),this.common.showToast("Voc\xea est\xe1 Offline agora"))}countDown(){let e=setInterval(()=>{this.remainingTime--,this.dealAlert.subHeader="Voc\xea tem "+this.remainingTime+" sec, para confirmar o atendimento",0===this.remainingTime&&(clearInterval(e),this.cancelDeal(),this.remainingTime=a.B5)},1e3);this.confirmJob()}cancelDeal(){this.dealStatus=!1,this.dealAlert.dismiss(),this.dealService.removeDeal(this.driver.uid)}ionViewDidEnter(){this.menuCtrl.enable(!0),this.afAuth.onAuthStateChanged(e=>{null!=e&&(this.driverService.getDriver(e.uid).valueChanges().subscribe(e=>{null!=e&&(this.driver=e,this.driver.isOnline&&this.platform.is("mobile")&&(this.platform.pause.pipe((0,l.q)(1)).subscribe(()=>{this.driver.isOnline&&(cordova.plugins.backgroundMode.setDefaults({id:-1,title:"Aplicativo do T\xe9cnico",text:"Background",hidden:!1,silent:!1}),cordova.plugins.backgroundMode.setEnabled(!0),cordova.plugins.backgroundMode.on("enable",()=>{console.log("background mode Enabled !!!"),cordova.plugins.backgroundMode.disableWebViewOptimizations(),cordova.plugins.backgroundMode.disableBatteryOptimizations()}))}),cordova.plugins.backgroundMode.on("active",()=>console.log("bgm: active")),cordova.plugins.backgroundMode.on("deactivate",()=>console.log("bgm: deactive")),cordova.plugins.backgroundMode.on("failure",()=>console.log("bgm: failed")),cordova.plugins.backgroundMode.on("disable",()=>{console.log("bgm: desabilitado")}),this.platform.resume.pipe((0,l.q)(1)).subscribe(()=>cordova.plugins.backgroundMode.setEnabled(!1))))}),this.tripService.getLastTrips(e.uid).valueChanges().pipe((0,l.q)(1)).subscribe(e=>{e.forEach(e=>{e.status!=a.MQ&&e.status!=a.MA||(this.tripService.setCurrentTrip(e.key),this.router.navigateByUrl("/pickup"))})}))})}range(e){return new Array(Math.round(e))}confirmJob(){this.alertCtrl.create({id:this.job.key,header:"Nova Solicita\xe7\xe3o",message:"<b>Local:</b> ("+this.job.origin.distance+"km)<br/>"+this.job.origin.vicinity,cssClass:"alert-button",buttons:[{text:"Rejeitar",role:"cancel",cssClass:"alert-button",handler:()=>{this.dealStatus=!1,this.dealService.removeDeal(this.driver.uid)}},{text:"Aceitar",handler:()=>{this.dealStatus=!1,this.dealService.acceptDeal(this.driver.uid,this.deal).then(()=>{this.router.navigateByUrl("pickup")})}}]}).then(e=>{this.dealAlert=e,this.dealAlert.present()}),this.playAudio()}watchDeals(){this.dealSubscription=this.dealService.getDeal(this.driver.uid).valueChanges().subscribe(e=>{if(e&&(this.deal=e,e.status==a.MN)){if(e.createdAt<Date.now()-1e3*a.B5)return this.dealService.removeDeal(this.driver.uid);this.dealStatus=!0,this.job=e,this.geolocation.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}).then(e=>{this.job.origin.distance=this.placeService.calcCrow(e.coords.latitude,e.coords.longitude,this.job.origin.location.lat,this.job.origin.location.lng).toFixed(0),this.countDown()},e=>this.common.showToast(e.message))}})}playAudio(){1==a.SS&&new Audio(a.VR).play()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(d.F),c.Y36(r.Br),c.Y36(g.q),c.Y36(h.e),c.Y36(u.k),c.Y36(p.b),c.Y36(m.sK),c.Y36(s.F0),c.Y36(r._q),c.Y36(r.t4),c.Y36(v.v),c.Y36(b.r),c.Y36(C.zQ),c.Y36(r.HT),c.Y36(M.a))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-home"]],decls:21,vars:11,consts:[["color","dark"],["slot","start"],["lines","none"],["onerror","this.src='./assets/img/default.png'",3,"src"],[2,"font-weight","500"],["name","star"],["slot","end",3,"ngModel","disabled","ionChange","ngModelChange"],[2,"margin","0","font-size","12px","font-size","12px","padding","4px 8px"],["class","message",4,"ngIf"],["id","map",2,"height","100%","width","100%"],[1,"message"]],template:function(e,t){1&e&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar",0),c.TgZ(2,"ion-buttons",1),c._UZ(3,"ion-menu-button"),c.qZA(),c.TgZ(4,"ion-title"),c._uU(5," JetPort "),c.qZA(),c.qZA(),c.TgZ(6,"ion-item",2),c.TgZ(7,"ion-avatar",1),c._UZ(8,"img",3),c.qZA(),c.TgZ(9,"ion-label"),c.TgZ(10,"h3",4),c._uU(11),c._UZ(12,"ion-icon",5),c.qZA(),c.TgZ(13,"p"),c._uU(14),c.qZA(),c.qZA(),c.TgZ(15,"ion-toggle",6),c.NdJ("ionChange",function(){return t.changeAvailability()})("ngModelChange",function(e){return t.driver.isOnline=e}),c.qZA(),c.qZA(),c.TgZ(16,"p",7),c._uU(17),c.qZA(),c.qZA(),c.TgZ(18,"ion-content"),c.YNc(19,O,2,0,"p",8),c._UZ(20,"div",9),c.qZA()),2&e&&(c.xp6(8),c.s9C("src",null==t.driver?null:t.driver.photoURL,c.LSH),c.xp6(3),c.AsE("",null==t.driver?null:t.driver.name," - ",null==t.driver?null:t.driver.rating," "),c.xp6(3),c.HOy("",null==t.driver?null:t.driver.brand," \u2022 ",null==t.driver?null:t.driver.model," \u2022\xa0",null==t.driver?null:t.driver.plate," \u2022\xa0",null==t.driver?null:t.driver.type,""),c.xp6(1),c.Q6J("ngModel",t.driver.isOnline)("disabled",!t.driver.isApproved),c.xp6(2),c.hij("Localiza\xe7\xe3o: ",t.locality,""),c.xp6(2),c.Q6J("ngIf",!t.driver.isApproved))},directives:[r.Gu,r.sr,r.Sm,r.fG,r.wd,r.Ie,r.BJ,r.Q$,r.gu,r.ho,r.w,o.JJ,o.On,r.W2,n.O5],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}.message[_ngcontent-%COMP%]{text-align:center;background:#ffc107;margin:0;padding:4px;font-size:14px}.buttoncss[_ngcontent-%COMP%]{color:#e74c3c;background-color:#000}.alertcss[_ngcontent-%COMP%]{background-color:aqua;color:#ffc107}.basic-alert[_ngcontent-%COMP%]{--backdrop-opacity:0.6;--background:linear-gradient(90deg,#1e00c9 1%,#f8fff8)}.alert-button-inner.sc-ion-alert-md[_ngcontent-%COMP%]{justify-content:flex-end;display:flex;flex-flow:row nowrap;flex-shrink:0;align-items:center;justify-content:center;width:100%;height:100%}.ion-tappable[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [tappable][_ngcontent-%COMP%]   span[_ngcontent-%COMP%], a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], button[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{touch-action:manipulation}*[_ngcontent-%COMP%]{box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}.alert-button[_ngcontent-%COMP%]{border-radius:2px;margin:0 8px 0 0;padding:10px;position:relative;background-color:#d4333300;color:#8a1616;font-weight:500;text-align:end;text-transform:uppercase;overflow:hidden}"]}),e})()}];let P=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[s.Bz.forChild(f)],s.Bz]}),e})(),_=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[n.ez,o.u5,r.Pc,m.aw,P]]}),e})()}}]);